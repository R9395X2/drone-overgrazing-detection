# 农户管理功能说明

本文档介绍无人机过度放牧检测系统的农户管理功能。

## 功能概述

农户管理功能允许用户：
- 管理农户基本信息
- 查看农户的历史检测记录
- 按农户组织盘点照片和检测结果
- 搜索和筛选农户信息

## 使用方法

### 1. 访问农户管理页面

- 在主页面点击"农户管理"按钮
- 或直接访问 `farmers.html`

### 2. 农户列表管理

#### 查看农户列表
- 系统显示所有农户的卡片式列表
- 每个卡片显示：
  - 农户姓名和联系电话
  - 羊群数量和草场面积
  - 最近检测时间和活跃状态

#### 搜索农户
- 使用顶部搜索框输入关键词
- 支持按姓名、电话、地址搜索
- 实时搜索结果更新

#### 筛选和排序
- 按状态筛选：活跃/非活跃
- 排序方式：按姓名/最近检测/羊群数量

### 3. 农户详细信息

#### 查看详情
点击任意农户卡片进入详情页面，包含：

**基本信息**
- 姓名、联系方式、地址
- 羊群数量、草场面积
- 备注信息

**统计信息**
- 总检测次数
- 最近检测日期
- 平均羊只数
- 过度放牧风险等级

**历史盘点记录**
- 按检测任务分组的文件夹式展示
- 每个任务包含：
  - 检测日期和任务名称
  - 媒体文件数量和类型
  - 检测结果摘要
  - 缩略图预览

#### 操作功能
- **编辑农户**: 修改农户基本信息
- **新建检测**: 为该农户创建新的检测任务
- **返回列表**: 回到农户列表页面

### 4. 添加和编辑农户

#### 添加新农户
1. 点击"添加农户"按钮
2. 填写农户信息：
   - 姓名（必填）
   - 联系电话
   - 地址
   - 羊群数量
   - 草场面积（平方米）
   - 备注
3. 点击"保存"完成添加

#### 编辑农户信息
1. 在农户详情页面点击"编辑"按钮
2. 修改相关信息
3. 点击"保存"更新信息

### 5. 历史盘点记录

#### 文件夹式展示
- 每次盘点作为一个文件夹显示
- 显示检测日期、文件数量、处理状态
- 包含检测结果摘要和缩略图预览

#### 筛选功能
- 按状态筛选：已完成/处理中/失败
- 按时间排序：最新在前/最旧在前

#### 查看详情
点击任务文件夹可查看：
- 所有照片和视频的缩略图
- 详细的检测结果
- 算法分析报告
- 原始文件下载链接

## 数据库结构

### 相关数据表

1. **farmers** - 农户基本信息
2. **detection_tasks** - 检测任务记录
3. **detection_results** - 具体检测结果
4. **task_summary** - 任务汇总统计

### 初始化示例数据

运行以下SQL脚本添加示例数据：
```bash
sqlite3 database/drone_detection.db < database/insert_sample_farmers.sql
```

## API接口

### 农户管理API (`/api/farmers`)

- `GET /api/farmers` - 获取所有农户
- `GET /api/farmers/:id` - 获取单个农户详情
- `POST /api/farmers` - 创建新农户
- `PUT /api/farmers/:id` - 更新农户信息
- `DELETE /api/farmers/:id` - 删除农户
- `GET /api/farmers/:id/tasks` - 获取农户的检测任务

### 请求示例

#### 创建农户
```javascript
POST /api/farmers
Content-Type: application/json

{
  "name": "张三",
  "phone": "13812345678",
  "address": "内蒙古呼伦贝尔市",
  "sheep_count": 120,
  "pasture_area": 1500.5,
  "notes": "备注信息"
}
```

#### 更新农户
```javascript
PUT /api/farmers/1
Content-Type: application/json

{
  "name": "张三",
  "phone": "13812345678",
  "address": "内蒙古呼伦贝尔市陈巴尔虎旗",
  "sheep_count": 125,
  "pasture_area": 1500.5,
  "notes": "更新的备注信息"
}
```

## 技术实现

### 前端组件
- `farmers.html` - 农户管理页面
- `styles/farmers.css` - 样式文件
- `scripts/farmers-manager.js` - 农户管理器
- `scripts/farmers-app.js` - 应用入口

### 后端服务
- `server/routes/farmers.js` - 农户API路由
- 集成到现有的Express服务器

### 特性
- 响应式设计，支持移动端
- 实时搜索和筛选
- 优雅的动画效果
- 错误处理和用户反馈

## 使用场景

1. **农户档案管理**: 建立和维护农户基本信息档案
2. **历史记录查询**: 快速查找特定农户的检测历史
3. **数据统计分析**: 了解农户的放牧情况和风险等级
4. **工作流程优化**: 以农户为核心组织检测工作

## 注意事项

1. 删除农户前会检查是否存在关联的检测记录
2. 农户状态根据最近检测时间自动计算
3. 统计数据基于历史检测结果动态计算
4. 搜索功能支持模糊匹配，提高查找效率

## 扩展功能

未来可以考虑添加：
- 农户分组管理
- 批量导入导出
- 检测计划调度
- 风险预警通知
- 报告自动生成
